<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Landing autÃ³noma â€” Contacto</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

  :root{
    --accent:#2563eb;
    --accent-hover:#1d4ed8;
    --bg:#f8fafc;
    --card:#ffffff;
    --muted:#64748b;
    --border:#e2e8f0;
    --text-primary:#0f172a;
    --text-secondary:#475569;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    font-family:'Inter',system-ui,-apple-system,sans-serif;
    background:linear-gradient(135deg,#f8fafc 0%,#e0e7ff 100%);
    color:var(--text-primary);
    line-height:1.6;
    font-size:15px;
  }

  .container{
    max-width:1100px;
    margin:0 auto;
    padding:32px 24px;
  }

  header{
    height:auto;
    min-height:320px;
    border-radius:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
    background:#001f3f;
    box-shadow:0 20px 60px rgba(0,31,63,0.3);
    margin-bottom:32px;
  }

  header .banner-text{
    z-index:2;
    text-align:center;
    color:#03396b;
    display:none;
  }

  header h1{margin:0;font-size:32px;font-weight:700}
  header p{margin:8px 0 0;color:var(--muted);font-weight:400}

  .banner-controls{
    position:absolute;
    right:16px;
    bottom:16px;
    z-index:3;
    display:flex;
    flex-direction:column;
    gap:6px;
    align-items:flex-end;
  }

  .banner-controls select{
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(10px);
    padding:8px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.3);
    cursor:pointer;
    font-size:18px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    transition:all 0.3s ease;
  }

  .banner-controls select:hover{
    background:rgba(255,255,255,1);
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    transform:translateY(-2px);
  }

  .banner-preview{
    position:absolute;
    inset:0;
    background-size:cover;
    background-position:center 38%;

    background-repeat:no-repeat;
    opacity:1;
    background-image:url('banner.jpeg');
    image-rendering:-webkit-optimize-contrast;
    image-rendering:crisp-edges;
    filter:brightness(1.05) contrast(1.05);
  }

  .card{
    background:var(--card);
    border-radius:16px;
    padding:28px;
    box-shadow:0 8px 30px rgba(0,0,0,0.06);
    border:1px solid var(--border);
  }

  .chat{display:flex;gap:24px}
  .chat .left{flex:1}
  .chat .right{width:400px}

  .bot-window{
    height:480px;
    border-radius:16px;
    border:1px solid var(--border);
    padding:20px;
    overflow:auto;
    background:linear-gradient(to bottom,#fafbfc,#ffffff);
    box-shadow:inset 0 2px 8px rgba(0,0,0,0.03);
  }

  .message{margin:12px 0;display:flex}
  .msg.bot{justify-content:flex-start}
  .msg.user{justify-content:flex-end}

  .bubble{
    max-width:80%;
    padding:14px 18px;
    border-radius:16px;
    background:#f1f5f9;
    color:var(--text-primary);
    font-size:14.5px;
    line-height:1.5;
    box-shadow:0 2px 8px rgba(0,0,0,0.04);
  }

  .bubble.user{
    background:linear-gradient(135deg,var(--accent),var(--accent-hover));
    color:#fff;
    box-shadow:0 4px 12px rgba(37,99,235,0.25);
  }

  .controls{display:flex;gap:10px;margin-top:16px}

  input[type="text"],input[type="email"],input[type="tel"],select,textarea{
    width:100%;
    padding:12px 16px;
    border-radius:12px;
    border:1.5px solid var(--border);
    font-family:inherit;
    font-size:14px;
    transition:all 0.2s ease;
    background:#fff;
  }

  input:focus,select:focus,textarea:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(37,99,235,0.1);
  }

  .small-row{display:flex;gap:10px}
  .small-row input{flex:1}

  .options{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:10px;
    margin-top:12px;
  }

  .option-btn{
    padding:12px 16px;
    border-radius:12px;
    border:1.5px solid var(--border);
    background:#fff;
    color:var(--text-primary);
    cursor:pointer;
    font-size:14px;
    font-weight:500;
    transition:all 0.2s ease;
    text-align:center;
  }

  .option-btn:hover{
    border-color:var(--accent);
    background:#f0f6ff;
    transform:translateY(-1px);
  }

  .option-btn.active{
    border-color:var(--accent);
    background:linear-gradient(135deg,#eff6ff,#dbeafe);
    color:var(--accent);
    box-shadow:0 4px 12px rgba(37,99,235,0.15);
    font-weight:600;
  }

  .footer-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:20px;
  }

  button{
    background:linear-gradient(135deg,var(--accent),var(--accent-hover));
    color:#fff;
    padding:12px 24px;
    border-radius:12px;
    border:0;
    cursor:pointer;
    font-weight:600;
    font-size:15px;
    transition:all 0.2s ease;
    box-shadow:0 4px 12px rgba(37,99,235,0.2);
  }

  button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 16px rgba(37,99,235,0.3);
  }

  button.ghost{
    background:#fff;
    color:var(--accent);
    border:1.5px solid var(--border);
    box-shadow:0 2px 8px rgba(0,0,0,0.04);
  }

  button.ghost:hover{
    background:#f8fafc;
    border-color:var(--accent);
  }

  .muted{
    color:var(--muted);
    font-size:13px;
    font-weight:500;
  }

  .consent{
    font-size:13px;
    margin-top:12px;
    line-height:1.6;
    color:var(--text-secondary);
  }

  .consent input[type="checkbox"]{
    margin-right:8px;
    width:18px;
    height:18px;
    cursor:pointer;
  }

  .links-row{display:flex;gap:10px;margin-top:10px}
  .links-row input{flex:1}

  h3{
    margin:0 0 20px 0;
    font-size:20px;
    font-weight:700;
    color:var(--text-primary);
  }

  a{
    color:var(--accent);
    text-decoration:none;
    font-weight:600;
    transition:color 0.2s ease;
  }

  a:hover{
    color:var(--accent-hover);
    text-decoration:underline;
  }

  .editable{
    background:#fefce8;
    padding:4px 8px;
    border-radius:6px;
    cursor:text;
    border:1px dashed #facc15;
    transition:all 0.2s ease;
  }

  .editable:hover{background:#fef9c3}
  .editable:focus{
    outline:none;
    border-color:var(--accent);
    background:#fff;
    box-shadow:0 0 0 3px rgba(37,99,235,0.1);
  }

  label{
    display:block;
    margin-bottom:8px;
    font-weight:500;
    color:var(--text-secondary);
  }

  /* Responsive Design - Mobile First */
  @media(max-width:640px){
    body{font-size:14px}

    .container{padding:16px 12px}

    header{
      min-height:auto;
      border-radius:12px;
      margin-bottom:20px;
    }

    /* Evitar distorsiÃ³n del banner en mÃ³vil */
    .banner-preview{
      background-size:100% auto;
      background-position:center center;

      image-rendering:auto;
      filter:brightness(1.0) contrast(1.02);
    }

    header h1{font-size:24px}

    .banner-controls{
      right:12px;
      bottom:12px;
    }

    .banner-controls select{
      padding:6px 10
      px;
      font-size:16px;
      border-radius:10px;
    }

    .card{
      padding:16px;
      border-radius:12px;
    }

    .chat{
      flex-direction:column;
      gap:16px;
    }

    .chat .right{width:100%}

    .bot-window{
      height:360px;
      padding:12px;
      border-radius:12px;
    }

    .bubble{
      max-width:85%;
      padding:10px 14px;
      font-size:14px;
    }

    .options{
      grid-template-columns:1fr;
      gap:8px;
    }

    .option-btn{
      padding:10px 14px;
      font-size:13px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea{
      padding:10px 14px;
      font-size:14px;
    }

    button{
      padding:10px 18px;
      font-size:14px;
      width:100%;
    }

    button.ghost{width:100%}

    .footer-actions{
      flex-direction:column;
      gap:8px;
    }

    h3{font-size:18px}

    .links-row{
      flex-direction:column;
      gap:8px;
    }
  }

  /* Tablet */
  @media(min-width:641px) and (max-width:880px){
    .container{padding:24px 16px}

    header{
      min-height:260px;
      border-radius:16px;
    }

    header h1{font-size:28px}

    .chat{
      flex-direction:column;
      gap:20px;
    }

    .chat .right{width:100%}

    .bot-window{height:420px}

    .options{
      grid-template-columns:repeat(2,1fr);
    }
  }

  /* Desktop Large */
  @media(min-width:1200px){
    .container{
      max-width:1200px;
      padding:40px 32px;
    }

    header{min-height:360px}

    .chat .right{width:440px}

    .bot-window{height:520px}

    /* Mostrar mÃ¡s ancho de la foto en desktop grande */
    .banner-preview{
      background-size:102%;
      background-position:center 40%;
    }
  }

  /* Touch Devices - Larger tap targets */
  @media(pointer:coarse){
    button,
    .option-btn,
    input[type="checkbox"]{
      min-height:44px;
    }

    .banner-controls select{
      min-height:44px;
      padding:10px 14px;
    }
  }

  /* Print Styles */
  @media print{
    body{background:#fff}
    header{box-shadow:none}
    .card{box-shadow:none;border:1px solid #ddd}
    .banner-controls{display:none}
    button{display:none}
  }
</style>
</head>
<body>
<div class="container">
  <header id="banner">
    <div class="banner-preview" id="bannerPreview"></div>
    <div class="banner-text">
      <h1>Â¿En quÃ© puedo ayudarte?</h1>
      <p>Completa el chat y cuÃ©ntanos tu proyecto</p>
    </div>
    <div class="banner-controls">
      <select id="langSelector" style="padding:4px 6px;border-radius:4px;border:1px solid #e6e9ef;background:#fff;cursor:pointer;font-size:16px;margin-top:6px">
        <option value="es">ðŸ‡ªðŸ‡¸</option>
        <option value="en">ðŸ‡¬ðŸ‡§</option>
      </select>
    </div>
  </header>

  <div class="card chat" aria-live="polite">
    <div class="left">
      <div class="bot-window" id="chatWindow" role="log" aria-atomic="false"></div>

      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <input id="userInput" type="text" placeholder="Escribe tu respuesta aquÃ­..." />
        <button id="sendBtn">ðŸ“¤</button>
        <button id="resetBtn" class="ghost" title="Reiniciar chat">ðŸ”„</button>
      </div>
      <div class="muted" style="margin-top:8px;display:none">El bot te guiarÃ¡ paso a paso. Puedes editar los datos directamente en el resumen o reiniciar con ðŸ”„</div>
    </div>

    <div class="right">
      <div class="card" style="padding:12px">
        <h3 id="summaryTitle">Resumen rÃ¡pido</h3>
        <div id="summary" class="muted" style="display:none !important">AÃºn no hay datos.</div>

        <div style="margin-top:12px">
          <label class="muted" id="linkedinLabel">LinkedIn</label>
          <div class="links-row">
            <input id="linkedinPersonal" type="text" placeholder="LinkedIn personal" />
            <input id="linkedinEmpresa" type="text" placeholder="LinkedIn de la empresa" />
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="muted" id="newsletterMainLabel">Â¿Ya estÃ¡s suscrito a mi Newsletter? <a href="https://www.barcelona-metropolitan.com/magazine/newsletter" target="_blank" rel="noopener">SuscrÃ­bete aquÃ­</a></label>
          <div style="margin-top:6px">
            <label><input id="newsletter" type="checkbox" /> SÃ­, estoy suscrito</label>
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="muted" id="gdprLabelElement">Consentimiento (obligatorio)</label>
          <div class="consent">
            <label><input id="gdpr" type="checkbox" /> Acepto que mis datos sean tratados por la entidad responsable de esta landing conforme al Reglamento (UE) 2016/679 y la legislaciÃ³n aplicable. Entiendo que puedo ejercer mis derechos de acceso, rectificaciÃ³n, supresiÃ³n y oposiciÃ³n.</label>
          </div>
        </div>

        <div class="footer-actions">
          <button id="btnCopy" class="ghost" style="display:none">Copiar JSON</button>
          <button id="btnDownload" class="ghost" style="display:none">Descargar JSON</button>
          <button id="btnMail" class="ghost">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <div style="margin-top:14px;display:none !important" class="muted">Puedes personalizar textos, colores y el comportamiento del botÃ³n de envÃ­o en el cÃ³digo.</div>
</div>

<script>
/* --- Sistema de idiomas --- */
let currentLang = 'es';

const translations = {
  es: {
    introPrompt: 'AyÃºdanos a comprender la naturaleza de tu solicitud para que podamos preparar el proceso y responder de manera oportuna y eficaz.',
    welcome: 'Hola ðŸ‘‹ Soy el asistente de Victor. Â¿CÃ³mo te llamas?',
    nombre: 'Tu nombre',
    apellido: 'Tu apellido',
    email: 'Tu correo electrÃ³nico',
    telefono: 'TelÃ©fono',
    empresa: 'Nombre de la empresa (opcional)',
    target: 'Describe tu target (ej: pymes, consumidores 25-40, B2B)',
    targetGeografico: 'Target geogrÃ¡fico principal (ej: Barcelona, EspaÃ±a, Europa)',
    ayudaQuestion: 'Â¿QuÃ© tipo de apoyo o soluciones beneficiarÃ­an mÃ¡s a tu proyecto?',
    ayudaOptions: [
      'Salud, bienestar y belleza',
      'ExpansiÃ³n internacional',
      'CaptaciÃ³n de capital',
      'BÃºsqueda de inversores',
      'Compradores potenciales',
      'Distribuidores potenciales',
      'Donaciones a ONG',
      'Asesor de confianza',
      'Gestor de pagos',
      'AuditorÃ­a comercial',
      'Desarrollo de software',
      'Apoyo en negociaciones',
      'ConstituciÃ³n de empresas',
      'InmigraciÃ³n y derecho de familia',
      'BÃºsqueda de talento',
      'Impuestos y gestiÃ³n patrimonial',
      'EducaciÃ³n internacional',
      'Fusiones y adquisiciones'
    ],
    compromisoQuestion: 'Â¿En quÃ© etapa te encuentras actualmente?',
    compromisoOptions: ['Investigando opciones','BÃºsqueda activa','Buscando inversiÃ³n', 'En Busca de clientes'],
    resumenAyudaText: 'CuÃ©ntanos brevemente quÃ© tipo de apoyo necesitas ',
    resumenAyudaQuestion: 'Â¿Deseas aÃ±adir detalles adicionales sobre tus necesidades especÃ­ficas? (Opcional)',
    confirm: 'Â¡Perfecto! Antes de finalizar, por favor completa los campos de LinkedIn si lo deseas y acepta el consentimiento GDPR en la columna derecha.',
    end: 'Una vez aceptes el consentimiento, haz clic en "Enviar" o descarga los datos.',
    selectOptions: 'Selecciona tus opciones y luego haz clic en Enviar.',
    useButtons: 'Por favor utiliza los botones mostrados en el chat para responder esta pregunta.',
    requiredField: 'Este campo es obligatorio.',
    validEmail: 'Introduce un correo vÃ¡lido.',
    selectAtLeastOne: 'Por favor selecciona al menos una opciÃ³n.',
    summary: 'Resumen rÃ¡pido',
    noData: 'AÃºn no hay datos.',
    linkedinLabel: 'LinkedIn',
    linkedinPersonalPh: 'LinkedIn personal',
    linkedinEmpresaPh: 'LinkedIn de la empresa',
    newsletterLabel: 'Por favor confirma si estÃ¡s suscrito a Barcelona-metropolitan.com (requerido).',
    newsletterLink: 'SuscrÃ­bete aquÃ­',
    newsletterCheck: 'SÃ­, confirmo que estoy suscrito a Barcelona-metropolitan.com',
    gdprLabel: 'Consentimiento (obligatorio)',
    gdprText: 'Acepto que mis datos sean tratados por la entidad responsable de esta landing conforme al Reglamento (UE) 2016/679 y la legislaciÃ³n aplicable. Entiendo que puedo ejercer mis derechos de acceso, rectificaciÃ³n, supresiÃ³n y oposiciÃ³n.',
    summaryLabel: 'Resumen rÃ¡pido',
    newsletterLabelMain: 'Â¿Ya estÃ¡s suscrito a mi Newsletter?',
    btnMail: 'Enviar',
    sendPlaceholder: 'Escribe tu respuesta aquÃ­...',
    sendBtn: 'ðŸ“¤',
    resetBtn: 'ðŸ”„',
    botHelper: 'El bot te guiarÃ¡ paso a paso. Puedes editar los datos directamente en el resumen o reiniciar con ðŸ”„',
    gdprRequired: 'Debes aceptar el consentimiento GDPR antes de copiar/enviar.',
    sentConfirm: 'âœ“ InformaciÃ³n enviada a Victor. Se pondrÃ¡ en contacto contigo en breve. La pÃ¡gina se reiniciarÃ¡.',
    resetConfirm: 'Â¿Seguro que quieres reiniciar el chat? Se perderÃ¡n todos los datos.',
    selectedPrefix: 'Seleccionaste:',
    pleaseEnter: 'Por favor ingresa'
  },
  en: {
    introPrompt: 'Help us understand the nature of your request so we can prepare and respond promptly and effectively.',
    welcome: 'Hello ðŸ‘‹ I\'m Victor\'s scheduling assistant. What\'s your name?',
    nombre: 'Your name',
    apellido: 'Your last name',
    email: 'Your email address',
    telefono: 'Phone number',
    empresa: 'Company name (optional)',
    target: 'Describe your target audience (e.g., SMEs, consumers 25-40, B2B)',
    targetGeografico: 'Primary geographic target (e.g., Barcelona, Spain, Europe)',
    ayudaQuestion: 'What type of support or solutions would best serve your project?',
    ayudaOptions: [
      'Health, wellness and beauty',
      'International Expansion',
      'Capital Raising',
      'Investor Search',
      'Potential Buyers',
      'Potential Distributors',
      'NGO Donations',
      'Trusted Broker',
      'Pay Master',
      'Commercial Due Diligence',
      'Software Development',
      'Negotiation Support',
      'Corporate Set Up',
      'Immigration + Family Law',
      'Talent Search',
      'Tax + Wealth Management',
      'International Education',
      'Mergers & Acquisitions'
    ],
    compromisoQuestion: 'What stage are you currently at?',
    compromisoOptions: ['Researching Options','Actively Searching','Seeking Investment'],
    resumenAyudaText: 'Briefly tell us what kind of support you need (optional)',
    resumenAyudaQuestion: 'Would you like to add any additional details about your specific requirements? (Optional)',
    confirm: 'Perfect! Before submitting, please complete the LinkedIn fields if desired and accept the GDPR consent in the right column.',
    end: 'Once you accept the consent, click "Submit" or download the data.',
    selectOptions: 'Select your options and then click Send.',
    useButtons: 'Please use the buttons displayed in the chat to answer this question.',
    requiredField: 'This field is required.',
    validEmail: 'Please enter a valid email address.',
    selectAtLeastOne: 'Please select at least one option.',
    summary: 'Quick Summary',
    noData: 'No data yet.',
    linkedinLabel: 'LinkedIn',
    linkedinPersonalPh: 'Personal LinkedIn',
    linkedinEmpresaPh: 'Company LinkedIn',
    newsletterLabel: 'Are you subscribed to our Newsletter? (required).',
    newsletterLink: 'Subscribe here',
    newsletterCheck: 'Yes, I confirm I am subscribed to our Newsletter',
    gdprLabel: 'Consent (required)',
    gdprText: 'I accept that my data will be processed by the entity responsible for this landing page in accordance with Regulation (EU) 2016/679 and applicable legislation. I understand that I can exercise my rights of access, rectification, deletion, and opposition.',
    summaryLabel: 'Quick Summary',
    newsletterLabelMain: 'Are you subscribed to my Newsletter?',
    btnMail: 'Submit',
    sendPlaceholder: 'Type your answer here...',
    sendBtn: 'ðŸ“¤',
    resetBtn: 'ðŸ”„',
    botHelper: '',
    gdprRequired: 'You must accept GDPR consent before copying or sending.',
    sentConfirm: 'âœ“ Information sent to Victor. He will get in touch with you shortly. The page will restart.',
    resetConfirm: 'Are you sure you want to restart the chat? All data will be lost.',
    selectedPrefix: 'You selected:',
    pleaseEnter: 'Please provide your'
  }
};

/* --- Datos y flujo del bot --- */
const state = {
  nombre: '', apellido: '', email: '', telefono: '', empresa: '', target: '', targetGeografico: '',
  ayuda: [], compromiso: '', resumenAyuda: '', newsletter: false, linkedinPersonal:'', linkedinEmpresa:'', gdpr:false
};

function getSteps() {
  const t = translations[currentLang];
  return [
    {id:'intro', type:'bot', text: t.introPrompt},
    {id:'welcome', type:'bot', text: t.welcome},
    {id:'nombre', type:'input', key:'nombre', placeholder: t.nombre},
    {id:'apellido', type:'input', key:'apellido', placeholder: t.apellido},
    {id:'email', type:'input', key:'email', placeholder: t.email, validate:'email'},
    {id:'telefono', type:'input', key:'telefono', placeholder: t.telefono},
    {id:'empresa', type:'input', key:'empresa', placeholder: t.empresa},
    {id:'target', type:'input', key:'target', placeholder: t.target},
    {id:'targetGeografico', type:'input', key:'targetGeografico', placeholder: t.targetGeografico},
    {id:'ayuda', type:'options', key:'ayuda', text: t.ayudaQuestion, options: t.ayudaOptions},
    {id:'compromiso', type:'select', key:'compromiso', text: t.compromisoQuestion, options: t.compromisoOptions},
    {id:'resumenAyuda', type:'input', key:'resumenAyuda', placeholder: t.resumenAyudaText, text: t.resumenAyudaQuestion},
    {id:'confirm', type:'bot', text: t.confirm},
    {id:'end', type:'bot', text: t.end}
  ];
}

let steps = getSteps();

let stepIndex = 0;
const chatWindow = document.getElementById('chatWindow');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const summaryEl = document.getElementById('summary');
const linkedinPersonal = document.getElementById('linkedinPersonal');
const linkedinEmpresa = document.getElementById('linkedinEmpresa');

function appendBot(text){
  const div = document.createElement('div'); div.className='message msg bot';
  const b = document.createElement('div'); b.className='bubble'; b.innerHTML = text;
  div.appendChild(b); chatWindow.appendChild(div); chatWindow.scrollTop = chatWindow.scrollHeight;
}
function appendUser(text){
  const div = document.createElement('div'); div.className='message msg user';
  const b = document.createElement('div'); b.className='bubble user'; b.innerText = text;
  div.appendChild(b); chatWindow.appendChild(div); chatWindow.scrollTop = chatWindow.scrollHeight;
}

function renderStep(){
  const s = steps[stepIndex];
  if(!s) return;
  if(s.type === 'bot'){
    appendBot(s.text);
    stepIndex++;
    setTimeout(renderStep,600);
    return;
  }
  if(s.type === 'input'){
    let displayText = s.text;
    const t = translations[currentLang];
    // Personalizar mensaje de resumen segÃºn opciones de ayuda seleccionadas
    if(s.key === 'resumenAyuda' && state.ayuda && state.ayuda.length > 0){
      displayText = `${t.selectedPrefix} ${state.ayuda.join(', ')}. ${t.resumenAyudaQuestion}`;
    }
    appendBot(displayText || (t.pleaseEnter + ' ' + s.placeholder));
    userInput.placeholder = s.placeholder || '';
    userInput.focus();
  } else if(s.type === 'options'){
    appendBot(s.text);
    // render option buttons inside chat
    const container = document.createElement('div'); container.className='options'; container.style.margin='8px 0';
    s.options.forEach(opt=>{
      const btn = document.createElement('button'); btn.className='option-btn'; btn.innerText=opt;
      btn.onclick = ()=> {
        // toggle selection
        if(!state[s.key]) state[s.key]=[];
        const arr = state[s.key];
        const idx = arr.indexOf(opt);
        if(idx===-1){ arr.push(opt); btn.classList.add('active'); }
        else { arr.splice(idx,1); btn.classList.remove('active'); }
        updateSummary();
      };
      container.appendChild(btn);
    });
    chatWindow.appendChild(container); chatWindow.scrollTop = chatWindow.scrollHeight;
    // show instruction to press enviar cuando termine
    const t = translations[currentLang];
    appendBot(t.selectOptions);
  } else if(s.type === 'select'){
    appendBot(s.text);
    const container = document.createElement('div'); container.style.margin='8px 0';
    s.options.forEach(opt=>{
      const btn = document.createElement('button'); btn.className='option-btn'; btn.innerText=opt;
      btn.onclick = ()=> {
        state[s.key]=opt;
        appendUser(opt);
        updateSummary();
        stepIndex++;
        setTimeout(renderStep,400);
      };
      container.appendChild(btn);
    });
    chatWindow.appendChild(container); chatWindow.scrollTop = chatWindow.scrollHeight;
  }
}

sendBtn.addEventListener('click', handleSend);
userInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleSend(); });

document.getElementById('resetBtn').addEventListener('click', ()=>{
  const t = translations[currentLang];
  if(confirm(t.resetConfirm)){
    location.reload();
  }
});

function handleSend(){
  const s = steps[stepIndex];
  const text = userInput.value.trim();
  const t = translations[currentLang];
  if(!s) return;
  if(s.type === 'input'){
    const requiredInputs = ['nombre','apellido','email','telefono'];
    if(requiredInputs.includes(s.key) && !text){
      alert(t.requiredField);
      return;
    }
    if(s.validate === 'email' && !/^\S+@\S+\.\S+$/.test(text)){
      alert(t.validEmail);
      return;
    }
    appendUser(text || '(sin respuesta)');
    state[s.key]=text;
    userInput.value=''; stepIndex++; updateSummary();
    setTimeout(renderStep,400);
  } else if(s.type === 'options'){
    // for multiple options, check if at least one is selected
    if(!state[s.key] || state[s.key].length === 0){
      alert(t.selectAtLeastOne);
      return;
    }
    appendUser(state[s.key].join(', '));
    stepIndex++;
    setTimeout(renderStep,400);
  } else {
    // for select type, instruct to use buttons
    alert(t.useButtons);
  }
}

function updateSummary(){
  const parts = [];
  if(state.nombre) parts.push('<strong>Nombre:</strong> <span contenteditable="true" class="editable" data-key="nombre">'+escapeHtml(state.nombre)+'</span>');
  if(state.apellido) parts.push('<strong>Apellido:</strong> <span contenteditable="true" class="editable" data-key="apellido">'+escapeHtml(state.apellido)+'</span>');
  if(state.email) parts.push('<strong>Email:</strong> <span contenteditable="true" class="editable" data-key="email">'+escapeHtml(state.email)+'</span>');
  if(state.telefono) parts.push('<strong>Tel:</strong> <span contenteditable="true" class="editable" data-key="telefono">'+escapeHtml(state.telefono)+'</span>');
  if(state.empresa) parts.push('<strong>Empresa:</strong> <span contenteditable="true" class="editable" data-key="empresa">'+escapeHtml(state.empresa)+'</span>');
  if(state.target) parts.push('<strong>Target:</strong> <span contenteditable="true" class="editable" data-key="target">'+escapeHtml(state.target)+'</span>');
  if(state.targetGeografico) parts.push('<strong>Target GeogrÃ¡fico:</strong> <span contenteditable="true" class="editable" data-key="targetGeografico">'+escapeHtml(state.targetGeografico)+'</span>');
  if(state.ayuda && state.ayuda.length) parts.push('<strong>Ayuda:</strong> '+escapeHtml(state.ayuda.join('; ')));
  if(state.compromiso) parts.push('<strong>Compromiso:</strong> '+escapeHtml(state.compromiso));
  if(state.resumenAyuda) parts.push('<strong>Resumen:</strong> <span contenteditable="true" class="editable" data-key="resumenAyuda">'+escapeHtml(state.resumenAyuda)+'</span>');
  summaryEl.innerHTML = parts.length ? parts.join('<br/>') : 'AÃºn no hay datos.';

  // Attach listeners to editable fields
  document.querySelectorAll('.editable').forEach(el=>{
    el.addEventListener('blur', function(){
      const key = this.dataset.key;
      state[key] = this.innerText.trim();
    });
  });
}

/* copy / download / mail */
document.getElementById('btnCopy').addEventListener('click', ()=>{
  collectExtras();
  const gdpr = document.getElementById('gdpr');
  if(!gdpr.checked){ alert('Debes aceptar el consentimiento GDPR antes de copiar/enviar.'); return; }
  const json = JSON.stringify(state, null, 2);
  navigator.clipboard.writeText(json).then(()=>alert('JSON copiado al portapapeles.'));
});
document.getElementById('btnDownload').addEventListener('click', ()=>{
  collectExtras();
  const gdpr = document.getElementById('gdpr');
  if(!gdpr.checked){ alert('Debes aceptar el consentimiento GDPR antes de copiar/enviar.'); return; }
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'datos-landing.json'; a.click();
});
document.getElementById('btnMail').addEventListener('click', async ()=>{
  collectExtras();
  const t = translations[currentLang];
  const gdpr = document.getElementById('gdpr');
  if(!gdpr.checked){ alert(t.gdprRequired); return; }

  const btn = document.getElementById('btnMail');
  const prevText = btn.innerText;
  btn.disabled = true;
  btn.innerText = currentLang === 'en' ? 'Sendingâ€¦' : 'Enviandoâ€¦';

  const subjectText = 'URGENTE - Contacto desde landing: ' + (state.nombre || 'sin nombre');
  const payload = {
    _subject: subjectText,
    _replyto: state.email || '',
    nombre: state.nombre,
    apellido: state.apellido,
    email: state.email,
    telefono: state.telefono,
    empresa: state.empresa,
    target: state.target,
    targetGeografico: state.targetGeografico,
    ayuda: (state.ayuda || []).join(', '),
    compromiso: state.compromiso,
    resumenAyuda: state.resumenAyuda,
    linkedinPersonal: state.linkedinPersonal,
    linkedinEmpresa: state.linkedinEmpresa,
    newsletter: state.newsletter ? 'sÃ­' : 'no',
    gdpr: state.gdpr ? 'aceptado' : 'no-aceptado',
    full_json: JSON.stringify(state)
  };

  const ok = await sendToFormspree(payload);
  if(ok){
    alert(t.sentConfirm);
    setTimeout(()=>{ location.reload(); }, 500);
  } else {
    const errorMsg = currentLang === 'en' ? 'There was a problem sending the data.' : 'Hubo un problema al enviar los datos.';
    alert(errorMsg);
    btn.disabled = false;
    btn.innerText = prevText;
  }
});

function collectExtras(){
  state.linkedinPersonal = linkedinPersonal.value.trim();
  state.linkedinEmpresa = linkedinEmpresa.value.trim();
  state.newsletter = document.getElementById('newsletter').checked;
  state.gdpr = document.getElementById('gdpr').checked;
}

/* --- EnvÃ­o a Formspree --- */
const FORMSPREE_ENDPOINT = "https://formspree.io/f/xlgelvvq";

async function sendToFormspree(data) {
  try {
    const res = await fetch(FORMSPREE_ENDPOINT, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify(data)
    });

    // Try to extract diagnostic info from Formspree
    let info = {};
    try { info = await res.json(); } catch {}
    console.log('[Formspree] status:', res.status, 'info:', info);

    if (res.ok) {
      return true;
    } else {
      // Surface useful errors to help debugging in production
      const msg = info && (info.error || info.message);
      alert(msg ? ('Formspree: ' + msg) : (currentLang === 'en' ? 'Form submit failed.' : 'Fallo al enviar el formulario.'));
      return false;
    }
  } catch (e) {
    console.error('[Formspree] network error:', e);
    alert(currentLang === 'en' ? 'Network error sending the form.' : 'Error de red al enviar el formulario.');
    return false;
  }
}

/* helper */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* Language selector */
document.getElementById('langSelector').addEventListener('change', (e)=>{
  currentLang = e.target.value;
  steps = getSteps();
  updateUILanguage();
  // restart chat with new language
  chatWindow.innerHTML = '';
  stepIndex = 0;
  renderStep();
});

function updateUILanguage(){
  const t = translations[currentLang];
  document.getElementById('userInput').placeholder = t.sendPlaceholder;
  document.getElementById('sendBtn').innerText = t.sendBtn;
  document.getElementById('summaryTitle').innerText = t.summaryLabel;
  document.querySelector('h3').innerText = t.summary;

  // Update newsletter main label
  const newsletterMainLabel = document.getElementById('newsletterMainLabel');
  if(newsletterMainLabel) {
    newsletterMainLabel.innerHTML = `${t.newsletterLabelMain} <a href="https://www.barcelona-metropolitan.com/magazine/newsletter" target="_blank" rel="noopener">${t.newsletterLink}</a>`;
  }

  // Update GDPR label element
  const gdprLabelElement = document.getElementById('gdprLabelElement');
  if(gdprLabelElement) {
    gdprLabelElement.innerText = t.gdprLabel;
  }

  // Update LinkedIn label and placeholders
  const linkedinLabelEl = document.getElementById('linkedinLabel');
  if(linkedinLabelEl) linkedinLabelEl.innerText = t.linkedinLabel;

  document.getElementById('linkedinPersonal').placeholder = t.linkedinPersonalPh;
  document.getElementById('linkedinEmpresa').placeholder = t.linkedinEmpresaPh;

  // Update GDPR label text preserving the checkbox
  const gdprCheckbox = document.getElementById('gdpr');
  const gdprChecked = gdprCheckbox ? gdprCheckbox.checked : false;
  document.querySelector('.consent label').innerHTML = `<input id="gdpr" type="checkbox" ${gdprChecked ? 'checked' : ''} /> ${t.gdprText}`;

  document.getElementById('btnMail').innerText = t.btnMail;

  // Update newsletter checkbox label
  const newsletterCheckbox = document.getElementById('newsletter');
  const newsletterChecked = newsletterCheckbox ? newsletterCheckbox.checked : false;
  newsletterCheckbox.parentElement.innerHTML = `<input id="newsletter" type="checkbox" ${newsletterChecked ? 'checked' : ''} /> ${t.newsletterCheck}`;
  updateSummary();
}

/* inicializa */
updateUILanguage();
renderStep();
updateSummary();
</script>
</body>
</html>
